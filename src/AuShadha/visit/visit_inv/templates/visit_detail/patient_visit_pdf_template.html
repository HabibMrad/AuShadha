<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
    "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>

<style type="text/css">
     @page {
            size: a4 portrait;
            margin: 1.0in 0.25in 0.5in 0.25in;
            padding: 0;
            background-image: url("{{STATIC_URL}}images/AuShadha_logo/AuShadha_logo_128.png");

            @frame header {
                -pdf-frame-content: headerContent;
                width: 8in;
                top: 0.5in;
                margin-left: 0.5in;
                margin-right: 0.5in;
                margin-bottom: 0.5in;
                height: 1.0in;
                background:#ddd;
            }
            @frame footer {
                -pdf-frame-content: footerContent;
                width: 8in;
                bottom: 0in;
                margin-left: 2cm;
                margin-right: 2cm;
                height: 1cm;
                background:#ddd;
            }

    }
            pdftoc {
                color: #666;
            }
            pdftoc.pdftoclevel0 {
                font-weight: bold;
                margin-top: 0.5em;
            }
            pdftoc.pdftoclevel1 {
                margin-left: 1em;
            }
            pdftoc.pdftoclevel2 {
                margin-left: 2em;
                font-style: italic;
            } 

</style>

</head>

<body>
  <div> <pdf:toc/> </div>

  <div id='headerContent' style="font-size:8px; font-style:italic;">
      Visit Report for : {{patient_detail_obj}} generated by {{user.username}} on {% now "jS F Y H:i" %}
      <hr>
  </div>

{%if visit_obj_list %}
<div>  

  <div>
    <hr>
      <h1> Visit Report for {{patient_detail_obj}} </h1>
      <p>
        <span> Name : {{patient_detail_obj}}    </span> 
        <span> Age  : {{patient_detail_obj.age}}</span> 
        <span> Sex  : {{patient_detail_obj.sex}}</span> 
        <span> Patient ID : {{patient_detail_obj.patient_hospital_id}}</span> 
      </p>
    <hr>
  </div>
  
      {% for visit_obj in visit_obj_list %}

        {% for visit_detail, visit_rel in visit_obj.iteritems %}

          <div >
            <div>
              <h2> Date : {{visit_detail.visit_date.date}}  - {{visit_detail.op_surgeon}} </h2>
              <p> {{visit_detail.visit_nature}} ( {{visit_detail.visit_status}} ) </p>
              {% if visit_detail.remarks != 'NAD' %}
                <p style="font-weight: bold;">
                  Remarks:
                </p>  
                <p style="padding-left : 15px; 
                          line-height  : 1.6em; 
                          text-align   : justify;
                          ">
                    {{visit_detail.remarks.capitalize}} 
                </p>
              {% endif %}
            </div>

            <div> 
              {% for obj, obj_list in visit_rel.iteritems %}
                <table>
                    <thead>
                      <tr>
                        <th style="font-weight : bold; 
                                   text-align  : left;"> {{obj.upper}}</th> 
                      </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td style="padding-left : 15px; 
                                line-height   : 1.6em; 
                                text-align    : left;
                                ">
                        {% for item in obj_list %}
                              {{item}}
                        {% endfor %}
                      </td>
                    </tr>
                    </tbody>
                </table>
              {% endfor %}
            </div>

            {% if visit_detail.has_fu_visits %}
              <p style="text-align:center; font-size: 16px; font-weight: bold;"> 
               Follow Ups 
              </p>
              {% for fu in visit_detail.has_fu_visits %}
                <h3> Date : {{fu.visit_date.date.isoformat}} </h3>
                <div class = "follow_up" 
                     style = "background    : white; 
                              border        : solid 1px #aaa; 
                              border-radius : 5px; 
                              position      : relative; 
                              left          : .1em;
                              padding       : .1em;
                              margin        : .1em;
                              line-height   : 2.1em;
                              word-wrap     : break-word;
                              white-space   : pre-line;
                              "
                   >
                      {{fu.formatted_obj|safe}}  
                </div>
              {% endfor %}
            {% endif %}
          </div>
<!--           <hr class="shadow_line"> -->
      {% endfor %}

      <div style="font-size:8px; font-style:italic; text-align:right; margin-top:10px;"> 

        Report Generated on {% now "jS F Y H:i" %} by {{user.username}} 
        <hr>
      </div>

      <div id="footerContent"> Page #<pdf:pagenumber/> of <pdf:pagecount/> </div>

      <div>
        <pdf:nextpage />
      </div> 

    {% endfor %}

</div>
{% else %}
<div>
  No OPD visits recorded for this Patient
</div>
{% endif %}

</body>
</html>
